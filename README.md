# [Extremity](https://github.com/dbtedman/kata-extremity)

> **âš ï¸ WARNING:** Not production ready code, instead a [Code Kata](https://github.com/dbtedman#code-kata) intended to
> hone my programming skills through practice and repetition.

[![CI GitHub Pipeline](https://img.shields.io/github/workflow/status/dbtedman/kata-extremity/ci?style=for-the-badge&logo=github&label=ci)](https://github.com/dbtedman/kata-extremity/actions/workflows/ci.yml)
[![sast workflow status](https://img.shields.io/github/workflow/status/dbtedman/kata-extremity/sast?style=for-the-badge&logo=github&label=sast)](https://github.com/dbtedman/kata-extremity/actions/workflows/sast.yml)
![language: php](https://img.shields.io/badge/language-php-blue.svg?style=for-the-badge)
![platform: wordpress plugin](https://img.shields.io/badge/platform-wordpress%20plugin-blue.svg?style=for-the-badge)
[![MIT License](https://img.shields.io/github/license/dbtedman/kata-extremity?color=orange&style=for-the-badge)](https://github.com/dbtedman/kata-extremity/blob/main/LICENSE.md)

Secure traffic flowing in and out of your WordPress site at its extremity.

-   [Getting Started](#getting-started)
-   [Verification](#verification)
-   [Design](#design)
-   [License](#license)

## Getting Started

```shell
nvm use && make
```

When developing with WordPress, you might need to help your IDE by downloading a copy of WordPress.

```shell
make help_ide
```

## Verification

### Linting

-   [Prettier](https://prettier.io)
-   [PHP Code Sniffer](https://github.com/squizlabs/PHP_CodeSniffer)

```shell
make lint
```

These rules can then be automatically applied:

```shell
make format
```

### Unit Testing

-   [PHPUnit](https://phpunit.de)

```shell
make test
```

Executes unit tests contained within the `test/unit/php` directory.

### Integration Testing

> âš ï¸ Currently only for manual testing.

```shell
make local
```

You can then access a live instance of WordPress with extremity plugin
installed [http://localhost:8080](http://localhost:8080).

## Design

### Concepts

#### Response Modification

Content generated by WordPress is modified to apply security best practices, such as the addition of a Content Security
Policy.

#### Suspicious Behaviour Reporting

On detection of behaviour that is considered to be potentially suspicious, a report is generated and delivered to the
configured reporting provider.

#### Protecting Personally Identifiable Information (PII)

WP-JSON endpoints that allow listing of user PII are disabled, along with automatically generated sitemap entries.

### Tech Stack

-   [Docker Desktop](https://www.docker.com/products/docker-desktopm)
-   [PHP (v7.4)](https://www.php.net) - This version will match
    the [minimum requirements for WordPress](https://en-au.wordpress.org/about/requirements/).
-   [WordPress (v6.0)](https://wordpress.org/)

### Coding Standards

-   [PSR-12: Extended Coding Style](https://www.php-fig.org/psr/psr-12/)

### Repository Structure

| Directory                    | Purpose                                                  |
| :--------------------------- | :------------------------------------------------------- |
| `./.github/workflows`        | GitHub Actions workflow definitions.                     |
| `./src/php/API`              | HTTP requests to API routes defined in WP-JSON.          |
| `./src/php/Hook`             | WP Actions and Filters.                                  |
| `./src/php/Internal/Domain`  | Code that defines the core application logic.            |
| `./src/php/Internal/Gateway` | Defines how the domain interfaces with external systems. |
| `./test/integration`         |                                                          |
| `./test/unit/php`            |                                                          |

### Security Mitigations

> ðŸ’¡ Organised around categories from the [OWASP Top 10 - 2021](https://owasp.org/www-project-top-ten/)
> and [OWASP API Security Top 10 2019](https://owasp.org/www-project-api-security/) projects.

#### [A01:2021-Broken Access Control](https://owasp.org/Top10/A01_2021-Broken_Access_Control/)

-   [GitHub Secret scanning](https://github.com/features/security) detects secrets incorrectly committed into the
    repository.

#### [A02:2021-Cryptographic Failures](https://owasp.org/Top10/A02_2021-Cryptographic_Failures/)

_No relevant mitigations are in place._

#### [A03:2021-Injection](https://owasp.org/Top10/A03_2021-Injection/) + [API8:2019 Injection](https://github.com/OWASP/API-Security/blob/master/2019/en/src/0xa8-injection.md)

-   All user provided data is considered unsafe until proven otherwise.
-   This plugin defines a [Content Security Policy](https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP). - _Currently
    in report only mode._

#### [A04:2021-Insecure Design](https://owasp.org/Top10/A04_2021-Insecure_Design/)

_No relevant mitigations are in place._

#### [A05:2021-Security Misconfiguration](https://owasp.org/Top10/A05_2021-Security_Misconfiguration/) + [API7:2019 Security Misconfiguration](https://github.com/OWASP/API-Security/blob/master/2019/en/src/0xa7-security-misconfiguration.md)

-   This plugin defines a [Content Security Policy](https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP). - _Currently
    in report only mode._

#### [A06:2021-Vulnerable and Outdated Components](https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/)

-   [Snyk](https://snyk.io) scans Composer and NPM dependencies for know vulnerabilities and creates pull requests to
    resolve the vulnerabilities when available.
-   `roave/security-advisories` package blocks the installation of vulnerable Composer packages.

#### [A07:2021-Identification and Authentication Failures](https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/) + [API2:2019 Broken User Authentication](https://github.com/OWASP/API-Security/blob/master/2019/en/src/0xa2-broken-user-authentication.md)

_No relevant mitigations are in place._

#### [A08:2021-Software and Data Integrity Failures](https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/)

-   Third party dependencies are carefully selected and described with explicit version numbers in `composer.json`
    and `package.json`.
-   [Snyk](https://snyk.io) or [GitHub Dependabot](https://github.com/features/security) will raise an alert if a
    suspicious package, or version of a package is being depended upon.
-   Dependencies required during development are seggregated from those required during operation of this plugin.

#### [A09:2021-Security Logging and Monitoring Failures](https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/) + [API10:2019 Insufficient Logging & Monitoring](https://github.com/OWASP/API-Security/blob/master/2019/en/src/0xaa-insufficient-logging-monitoring.md)

_No relevant mitigations are in place._

#### [A10:2021-Server-Side Request Forgery](https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/)

_No relevant mitigations are in place._

#### [API1:2019 Broken Object Level Authorization](https://github.com/OWASP/API-Security/blob/master/2019/en/src/0xa1-broken-object-level-authorization.md)

_No relevant mitigations are in place._

#### [API3:2019 Excessive Data Exposure](https://github.com/OWASP/API-Security/blob/master/2019/en/src/0xa3-excessive-data-exposure.md)

_No relevant mitigations are in place._

#### [API4:2019 Lack of Resources & Rate Limiting](https://github.com/OWASP/API-Security/blob/master/2019/en/src/0xa4-lack-of-resources-and-rate-limiting.md)

_No relevant mitigations are in place._

#### [API5:2019 Broken Function Level Authorization](https://github.com/OWASP/API-Security/blob/master/2019/en/src/0xa5-broken-function-level-authorization.md)

_No relevant mitigations are in place._

#### [API6:2019 Mass Assignment](https://github.com/OWASP/API-Security/blob/master/2019/en/src/0xa6-mass-assignment.md)

_No relevant mitigations are in place._

#### [API9:2019 Improper Assets Management](https://github.com/OWASP/API-Security/blob/master/2019/en/src/0xa9-improper-assets-management.md)

_No relevant mitigations are in place._

## License

The [MIT License](./LICENSE.md) is used by this project.
